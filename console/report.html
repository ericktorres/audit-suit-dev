<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Audit Suit - Report</title>
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<link href="css/app.css" rel="stylesheet">
	<link href="css/questionnaires.css" rel="stylesheet">

	<script src="js/Chart.bundle.js"></script>
		<style type="text/css">

		#imag_firma{
		    width: 400px;
		    height: 150px;
		    margin: 0 auto;
		    /* margin: calc(10vh - 150px) auto 0; */
		    background: #fff;
		    border-radius: 3px;
		    box-shadow: 0px 0px 15px 3px #ccc;
		     text-align: center;
		    display: block;

		}
		#imag_firma2{
		    width: 400px;
		    height: 150px;
		    margin: 0 auto;
		    /* margin: calc(10vh - 150px) auto 0; */
		    background: #fff;
		    border-radius: 3px;
		    box-shadow: 0px 0px 15px 3px #ccc;
		     text-align: center;
		    display: block;

		}
		th, td {
		  padding: 2px;
		}

	</style>

</head>
<body id="target">
	<input type="hidden" id="hdn_report_id" value="">
	<input type="hidden" id="hdn_report_id_date" value="">
	<nav class="navbar navbar-inverse navbar-fixed-top">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>                  
				</button>
				<a id="logo_container" class="navbar-brand" href="#"></a>
			</div>
			<div id="navbar" class="collapse navbar-collapse">
				<ul class="nav navbar-nav" id="ul_menu">
				</ul>
				<ul class="nav navbar-nav navbar-right">
					<li class="dropdown">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span id="lbl_user_name"></span> <span class="caret"></span></a>
						<ul class="dropdown-menu">
							<li><a href="change-password.html">Cambiar contraseña</a></li>
							<li><a href="javascript:logout();">Cerrar sesión</a></li>
						</ul>
					</li>
				</ul>

			</div><!--/.nav-collapse -->
		</div>
	</nav>

	<!-- body -->
	<div class="container fifty-top">
		<div class="page-header">
			<button type="button" class="btn btn-default" onclick="backToReports();"><span class="glyphicon glyphicon-chevron-left"></span> Regresar</button>
			<!--<button type="button" class="btn btn-info" aria-label="Left Align" onclick="downloadReport();"><span class="glyphicon glyphicon-save" aria-hidden="true"></span> Descargar</button>-->

			<button id="btn_send_to_review" type="button" class="btn btn-warning" aria-label="Left Align" onclick="reviewReport();" dissabled><span class="glyphicon glyphicon-ok" aria-hidden="true"></span> Revisar</button>
			<button id="btn_approves" type="button" class="btn btn-primary" aria-label="Left Align" onclick="approveReport();" dissabled><span class="glyphicon glyphicon-thumbs-up" aria-hidden="true"></span> Aprobar</button>
			<button id="btn_release_report" type="button" class="btn btn-success" aria-label="Left Align" onclick="releaseReport();" dissabled><span class="glyphicon glyphicon-send" aria-hidden="true"></span> Liberar</button>
			<!--<button id="btn_export_pdf" type="button" class="btn btn-default" aria-label="Left Align" onclick="exportToPDF();" dissabled><span class="glyphicon glyphicon-save-file" aria-hidden="true"></span> Exportar PDF</button> -->
			<button id="btn_export_pdf" type="button" class="btn btn-default" aria-label="Left Align" onclick="expToPDF();" dissabled><span class="glyphicon glyphicon-save-file" aria-hidden="true"></span> Exportar PDF</button>

			<button id="btn_export_excel" type="button" class="btn btn-default" aria-label="Left Align" onclick="expToEXCEL();" dissabled><span class="glyphicon glyphicon-save-file" aria-hidden="true"></span> Exportar EXCEL</button>

			<button class="btn btn-default" onclick="viewInform();" id="viewReportPr"><span class="glyphicon glyphicon-eye-open"></span> Ver Informe Preliminar</button>


		</div>

		<div id="pdf-content">
			<div>&nbsp;</div>
			<div class="panel panel-default" id="pdf-content-1">
				<div class="panel-heading">
					<h3 class="panel-title" id="titledg">Datos generales</h3>
				</div>

				<div class="panel-body">
					<table width="100%" id="tabla1" >
						<thead>
							<tr>
								<th colspan="5" style="text-align: center;background-color: black;color: white;">REPORTE <span id="sp_report_number"></span></th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td><b>CLIENTE:</b></td>
								<td><span id="sp_client"></span></td>
								<td><b>SITIO:</b></td>
								<td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>								
								<td><span id="sp_branch"></span></td>
							</tr>
							<tr>
								<td><b>CUESTIONARIO:</b></td>
								<td><span id="sp_questionnaire"></span></td>
								<td><b>CÓDIGO:</b></td>
								<td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
								<td style="text-align: left;"><span id="sp_questionnaire_code"></span></td>
							</tr>
							<tr>
								<td><b>FECHA Y HORA DE INICIO:</b></td>
								<td style="text-align: left;"><span id="start_date"></span></td>  
								<td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>            
								<td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
								<td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
							</tr>
							<tr>
								<td><b>FECHA Y HORA DE FINALIZACIÓN:</b></td>
								<td style="text-align: left;"><span id="end_date"></span></td> 
								<td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>    
								<td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
								<td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>       	
							</tr>
							<tr>
								<td><b>RESULTADO TOTAL: </b></td>
								<td><span id="span_total_percentage"></span> de 100%.</td>
								<td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
								<td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
								<td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
							</tr>

						</tbody>
					</table>
					<input type="text" id="txt_audit_date" style="display: none;" class="form-control" placeholder="YYYY-mm-dd" onblur="assignAuditDate();">
					<span id="td-audit-date"></span>

				</div>
			</div>


			<div class="page-break panel panel-default">
				<div class="panel-heading">
					<h3 class="panel-title">
						<a data-toggle="collapse" href="#collapsesecfir">Firmas: </a>
					</h3>
				</div>

				<div id="collapsesecfir" class="panel-collapse collapse">
					<div class="panel-body">
						<table width="100%">
						<tr>
							<th colspan="2" style="text-align: center;background-color: black;color: white;">FIRMAS</th>
						</tr>
						<tr>
							<td style="text-align: center;"><b>Firma quien atiende</b></td>
							<td style="text-align: center;"><b>Firma Auditor</b></td>
						</tr>						
						<tr>
							<td style="text-align: center;">
								<img id="imag_firma" src="" />						
							</td>
							<td style="text-align: center;">
								<img id="imag_firma2" src="" />
							</td>
						</tr>
						<tr>
							<td style="text-align: center;">						
								<span id="txt_res_audit"></span>
							</td>
							<td style="text-align: center;">
								<span id="sp_auditor"></span>
							</td>
						</tr>

					</table>
					</div>
				</div>
			</div>

			<div class="page-break panel panel-default">
				<div class="panel-heading">
					<h3 class="panel-title">
						<a data-toggle="collapse" href="#collapsesec1">Resultados por sección</a>
					</h3>
				</div>

				<div id="collapsesec1" class="panel-collapse collapse">
					<div class="panel-body">
						<table width="100%" id="tabla2" >
							<thead>
								<tr>
									<th colspan="5" style="text-align: center;background-color: black;color: white;">RESULTADOS POR SECCIÓN</th>
								</tr>
								<tr>
									<th style="text-align:center;">No</th>									
									<th colspan="2">SECCIÓN</th>
									<th>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
									<th>RESULTADO</th>
								</tr>    
							</thead>
							<tbody id="tbody_sections_result"></tbody>
						</table>
					</div>
				</div>
			</div>

			<div class="page-break panel panel-default">
				<div class="panel-heading">
					<h3 class="panel-title">
						<a data-toggle="collapse" href="#collapseg1">Gráfica de resultados</a>
					</h3>
				</div>

				<div id="collapseg1" class="panel-collapse collapse">
					<div class="panel-body">
						<table width="100%" id="tabla6" >
							<thead>
								<tr>
									<th colspan="5" style="text-align: center;background-color: black;color: white;">GRÁFICA DE RESULTADOS</th>
								</tr>
								<tr>
									<th style="text-align:center;"></th>									
									<th colspan="2"></th>
									<th>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
									<th></th>
								</tr>    
							</thead>
							<tbody id="tbody_sections_result"></tbody>
						</table>

						<div class="panel-body text-center" id="canvas-panel">
							<canvas id="results-by-section" width="300" height="200"></canvas>
						</div>
					</div>
				</div>
			</div>

			<div class="page-break panel panel-default">
				<div class="panel-heading">
					<h3 class="panel-title">
						<a data-toggle="collapse" href="#collapse1">Preguntas respondidas</a>
					</h3>
				</div>

				<div id="collapse1" class="panel-collapse collapse">
					<div class="panel-body">
						<table class="table" id="tabla3">
							<thead>
								<tr>
									<th colspan="5" style="text-align: center;background-color: black;color: white;">PREGUNTAS RESPONDIDAS</th>
								</tr>
								<tr>
									<th></th>
									<th></th>
									<th>RESPUESTA</th>
									<th>PUNTAJE</th>
									<th class="print-hide">EDITAR</th>
								</tr>
							</thead>
							<tbody id="tbody_report_questions"></tbody>
						</table>
					</div>
				</div>
			</div>

			<div class="panel panel-default">
				<div class="panel-heading">
					<h3 class="panel-title">
						<a data-toggle="collapse" href="#collapse2">Áreas de oportunidad</a>
					</h3>
				</div>

				<div id="collapse2" class="panel-collapse collapse">
					<div class="panel-body">
						<table class="table" id="tabla4" >
							<thead>
								<tr>
									<th colspan="5" style="text-align: center;background-color: black;color: white;">ÁREAS DE OPORTUNIDAD</th>
								</tr>
								<tr>
									<th>SECCIÓN</th>
									<th>PREGUNTA</th>
									<th>RESPUESTA</th>
									<th>PUNTAJE</th>
									<th>EDITAR</th>
									<!--<th>OBSERVACIONES</th>-->
								</tr>
							</thead>
							<tbody id="tbody_opportunity"></tbody>
						</table>
					</div>
				</div>
			</div>

		</div>
		<!-- Modal edit answer -->
		<div class="modal fade" id="edit-answer" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h3 class="modal-title" id="exampleModalLabel">Modificar Respuesta</h3>
					</div>
					<div class="modal-body">

						<div id="alert-edit-answer" class="alert alert-success alert-dismissible alert-hide" role="alert">
							<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
							<div id="alert-message"></div>
						</div>

						<form id="frm-edit-answer">
							<table class="form-tbl">
								<tr>
									<td>ID RESPUESTA</td>
									<td><input type="text" id="txt_answer_id" class="form-control" disabled="true">
										<input type="hidden" id="hdn_question_max_value">
									</td>
								</tr>
								<tr>
									<td>SECCIÓN</td>
									<td><input type="text" id="txt_section" class="form-control" disabled="true"></td>
								</tr>
								<tr>
									<td>PREGUNTA</td>
									<td><input type="text" id="txt_question" class="form-control" disabled="true"></td>
								</tr>
								<tr>
									<td>RESPUESTA</td>
									<td>
										<select class="form-control" id="slc_answer" onchange="editAnswerValue();"></select>
									</td>
								</tr>
								<tr>
									<td>PUNTAJE</td>
									<td><input type="text" class="form-control" id="txt_value" disabled></td>
								</tr>
								<tr>
									<td>OBSERVACIONES</td>
									<td><textarea class="form-control" id="txa_observations" rows="5"></textarea></td>
								</tr>
								<tr>
									<td>NO CONFORMIDAD</td>
									<td><textarea class="form-control" id="txa_nonconformity" rows="5"></textarea></td>
								</tr>
								<tr>
									<td>NO APLICA</td>
									<td><input type="checkbox" id="chk_notapply"></td>
								</tr>
							</table>
						</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-primary" onclick="editQuestionAnswer();"><span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span> Modificar Respuesta</button>
						<button type="button" class="btn btn-secondary" data-dismiss="modal"><span class="glyphicon glyphicon-eye-close" aria-hidden="true"></span> Cancelar</button>
					</div>
				</div>
			</div>
		</div>

				<!-- Modal Para ocultar imagen, pero si cargarla -->
		<div class="modal fade" id="coultaimg" tabindex="-1" role="dialog" aria-labelledby="modal_ocultaImagen" aria-hidden="true">
			<div class="modal-dialog" role="document">
				<div class="modal-content">

						<table id="tabla5" width="100%">
							<thead>
							</thead>
							<tbody>
								<tr>
									<td><img src="https://dev.bluehand.com.mx/console/img/main-logo/gepp_m.png" width="100"></td>
									<td></td>
									<td></td>
									<td></td>
									<td>&nbsp;</td>
								</tr>
								<tr>
									<td>&nbsp;</td>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
								</tr>
								<tr>
									<td>&nbsp;</td>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
								</tr>
							</tbody>
						</table>


					
				</div>
			</div>
		</div>

	</div>

	<script src="js/jquery-1.12.4.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/printThis.js"></script>


	<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>-->
	<script src="js/location.js"></script>
	<script src="js/report.js"></script>
	<script src="js/app.js"></script>
	<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.debug.js"></script> -->

	<script>
		$(document).ready(function(){
			setSessionData();
			setMenu('', '', '', '', ' class="active"', '', '');
			getGeneralData();
			getResultsBySection(1);
			getReportQuestions();
			getOpportunityAreas();
			manageReleaseButtons();
			reportOpened();
			//manageReportActions();
			loadLogo();
			setTimeout(function(){ saveReportData() }, 2000);
		});

		var expToEXCEL = function(){
				var filename = "Audit Suit - Report";
			    var downloadLink;
			    var dataType = 'application/vnd.ms-excel';
			    
			    //var encabezadoRep = '<h1>Reporte</h1>';
			    //var tableSelect = [document.getElementById('tblencabezado'),document.getElementById('collapsesec1')];
				var tableSelect5 = document.getElementById('tabla5');				
			    var tableSelect = document.getElementById('tabla1');
				var tableSelect2 = document.getElementById('tabla2');
				var tableSelect3 = document.getElementById('tabla3');
				var tableSelect4 = document.getElementById('tabla4');

				
			    //var tableHTML = tableSelect.outerHTML.replace(/ /g, '%20');
			    
			    
			    	//var tableHTML0 = encabezadoRep.outerHTML.replace(/ /g, '%20');
			    //var	tableHTML = '<table%20width="100%"%20><thead><th%20colspan="4"%20style="text-align:%20center;background-color:%20black;color:%20white;">REPORTE</th></thead></table>';
			    //var tableHTML = '<table%20width="100%"%20class="table"><thead><th%20colspan="4"%20style="text-align:%20center;background-color:%20black;color:%20white;">REPORTE</th></thead></table>';
			    
			   	var tableHTML5 = tableSelect5.outerHTML.replace(/ /g, '%20');
			   	var tableHTML = tableSelect.outerHTML.replace(/ /g, '%20');
			    var tableHTML2 = tableSelect2.outerHTML.replace(/ /g, '%20');
			    var tableHTML3 = tableSelect3.outerHTML.replace(/ /g, '%20');
				var tableHTML4 = tableSelect4.outerHTML.replace(/ /g, '%20');

							    
			   	//console.log(tableHTML);
			    //console.log(tableHTML2);
			    
			    // Specify file name
			    filename = filename?filename+'.xls':'excel_data.xls';
			    
			    // Create download link element
			    downloadLink = document.createElement("a");
			    
			    document.body.appendChild(downloadLink);
			    
			    if(navigator.msSaveOrOpenBlob){
			        var blob = new Blob(['ufeff',tableHTML5,tableHTML,tableHTML2,tableHTML3,tableHTML4], {
			            type: dataType
			        });
			        navigator.msSaveOrOpenBlob( blob, filename);
			    }else{
			        // Create a link to the file
			        downloadLink.href = 'data:' + dataType + ', ' + tableHTML5 + ', ' + tableHTML + ', ' + tableHTML2 + ', ' + tableHTML3 + ', ' + tableHTML4;

			        //downloadLink.href = 'data:' + dataType + ', ' + tableHTML;
			    
			        // Setting the file name
			        downloadLink.download = filename;
			        
			        //triggering the function
			        downloadLink.click();
			    }
			

		}


//#collapseg1 grafica
		var expToPDF = function(){
			//,#pdf-content-1,#collapseg1,#collapsesecfir,#collapsesec1,#collapse1,#collapse2
			$('#pdf-content-1,#collapsesecfir,#collapsesec1,#collapse1,#collapse2').printThis({
				importCSS: true,            // import parent page css
			    importStyle: true,         // import style tags
			    printContainer: true,       // print outer container/$.selector
			  	loadCSS: ["./console/css/questionnaires.css","./console/css/app.css"],
			    canvas: true,
		        //pageTitle: 'REPORTE',
		        header: '<img src="https://dev.bluehand.com.mx/console/img/main-logo/gepp_m.png" width="92">',
		        //footer: '<img style="position:absolute; bottom:5px; right:10px;" src="https://dev.bluehand.com.mx/console/img/AuditSuit_logo_sinfondo.jpg" width="92" >',
		        footer: '<img style="position: fixed; bottom: 0;" src="https://dev.bluehand.com.mx/console/img/AuditSuit_logo_sinfondo.jpg" width="92" >'
		    });
		}

	</script>
</body>
</html>